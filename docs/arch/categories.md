[В начало](../index.md)
---

# Категории Nested Tree

## Описание

В основном категории используются по прямому назначению. 
Но помимо категорий, можно хранить любые другие данные, 
которые требуют вложенности и организованности данных.

## Структура

### Таблицы

* App/Models/Category

### Миграции

* 2018_03_20_085355_create_categories_table.php

### Сервисы

* App/Services/CategoryService

### Зависимости

* [kalnoy/nestedset](https://packagist.org/packages/kalnoy/nestedset)

### Реализация

Таблица для хренения данных организована таким образом, что, например 
данные категорий для новостей, категорий для контента и данные 
меню не смешиваются и их можно получить отдельно. Данная функциональность 
разруливается через поле в таблице под именем `owner`

**Описание полей в таблице**

* id - айди записи
* owner - принадлежность записи к какой-либо группе
* url - опциональное поле, в него записывается URL при создании меню.
* handler - опциональное поле. Используется также для построения 
меню. Например туда можно записать `has-handler` и при 
построении меню, в элемент меню добавить класс `handler`, а также значение из 
поля в атрибут data-handler. Далее js-ом слушать клик по классу `has-handler` и 
уже на основании данных из атрибута data-handler что-то делать.
* target - булево значение. Также используется при построении меню, 
чтобы задать ссылке атрибут `target`. Обычно это `_blank`
* name - название записи. 
* slug - слаг для URI если потребуется использовать запись как часть урла.
* _lft, _rgt, parent_id - элементы nested tree. Беспокоиться за них не нужно, 
они формируются автоматически

### Использование

#### CategoryService

Сервис для управления данными nested tree.

**Метод get**

В качестве параметра принимает айди записи и возвращает модель `Category`

**Метод create**

В качестве единственного параметра принимает `Illuminate\Http\Request`. 
Сам Request должен содержать следующие поля:

* owner - название группы данных
* name - название записи
* parent_id - **опциональное поле**. Следует передавать только в том случае, 
если создаваемы элемент должен быть ребенком ранее созданного элемена

Метод возвращает созданную модель `Category`

**Метод update**

Принимает два параметра:

* request - `Illuminate\Http\Request`
* categoryId - айди записи, которую намерены обновить

Сам request должен содержать следующие поля:

* name - новое имя, которое хотим задать элементу
* parent_id - **опциональное** поле, если требуется сменить родителя

**Метод up**

Принимает айди записи и поднимает на один уровень в структуре дерева

**Метод down**

Принимает айди записи и опускает на один уровень в структуре дерева

**Метод categoriesForSelect**

Принимает в качестве параметра овнера и возвращает массив в 
качестве ключа содержащий ID записи, в качестве значения поле name. Также перед значением 
поля name дописывает `-` если этот элемент вложен


Посмотреть примеры использования категорий можно в контроллере Backend/Content/NewsController